{% extends 'blog/base.html' %}

{% block title %}Game Blog{% endblock %}

{% block content %}

<section class="filters" aria-label="Filter posts">
    <div class="filter-links">
        <a
            href="{% url 'blog:post_list' %}"
            class="{% if not current_type %}active{% endif %}"
            >All</a
        >
        {% for key, label in game_types %}
        <a
            href="{% url 'blog:post_list' %}?type={{ key }}"
            class="{% if current_type == key %}active{% endif %}"
            >{{ label }}</a
        >
        {% endfor %}
    </div>
    <div class="filter-links" aria-label="Filter by tag">
        <a
            href="{% url 'blog:post_list' %}{% if current_type %}?type={{ current_type }}{% endif %}"
            class="{% if not current_tag %}active{% endif %}"
            >All tags</a
        >
        {% for tag in tags %}
        <a
            href="{% url 'blog:post_list' %}?tag={{ tag.slug }}{% if current_type %}&type={{ current_type }}{% endif %}"
            class="{% if current_tag == tag.slug %}active{% endif %}"
            >{{ tag.name }}</a
        >
        {% endfor %}
    </div>
    <form method="get">
        {% if current_type %}
        <input type="hidden" name="type" value="{{ current_type }}" />
        {% endif %}
        {% if current_tag %}
        <input type="hidden" name="tag" value="{{ current_tag }}" />
        {% endif %}
        <input
            type="search"
            name="q"
            placeholder="Search posts by title"
            value="{{ search_query }}"
            aria-label="Search posts by title"
        />
    </form>
</section>

{% if posts %}
    {% for post in posts %}
<article class="card">
    {% if post.image %}
    <img
        src="{{ post.image.url }}"
        alt="{{ post.title }} cover"
        class="post-image"
        loading="lazy"
    />
    {% endif %}
    <h2>
        <a href="{% url 'blog:post_detail' slug=post.slug %}"
            >{{ post.title }}</a
        >
    </h2>
    {% if post.tags.all %}
    <div class="tag-list">
        {% for tag in post.tags.all %}
        <a
            class="tag-chip"
            href="{% url 'blog:post_list' %}?tag={{ tag.slug }}"
            >{{ tag.name }}</a
        >
        {% endfor %}
    </div>
    {% endif %}
    <div class="meta">
        {{ post.get_game_type_display }} · {{ post.author }} · {{
        post.created_at|date:"M d, Y" }}
    </div>
    {% if post.excerpt %}
    <p>{{ post.excerpt }}</p>
    {% else %}
    <p>{{ post.content|truncatewords:40 }}</p>
    {% endif %}
    <div class="actions">
        <a class="btn" href="{% url 'blog:post_detail' slug=post.slug %}"
            >Read more</a
        >
    </div>
</article>
{% endfor %}

{% else %}
<div class="card">
    <p>No posts yet. Create the first one!</p>
</div>
{% endif %}

{% endblock %}
